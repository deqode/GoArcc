version: '3.3'

volumes:
  postgres:
  scylla:
  go_mod:

services:

#  backend_api:
#    build: .
#    volumes:
#      - .:/app
#      - ./../common:/common
#      - go_mod:/go/pkg/mod
#    env_file:
#      - envs/common.env
#      - envs/backend_api.env
#    command: bin/api
#    depends_on:
#      - postgres

  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "6831:6831/udp"
      - "16686:16686"

  centrifugo:
    container_name: centrifugo
    image: centrifugo/centrifugo:latest
    volumes:
      - ./config/centrifugo.yaml:/centrifugo/centrifugo.yaml
    command: centrifugo --config=centrifugo.yaml
    ports:
      - 7070:7070
      - 9000:9000
    ulimits:
      nofile:
        soft: 65535
        hard: 65535


  prometheus:
    image: prom/prometheus:latest
    ports:
      - 9090:9090
    command:
      - --config.file=/etc/prometheus/prometheus.yml
    volumes:
      - ./telementry/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro

  scylla:
    image: scylladb/scylla:4.3.1
    command:
      - "--smp"
      - "1"
    ports:
      - "9042:9042"
    volumes:
      - scylla:/var/lib/scylla

  statsd:
    image: graphiteapp/graphite-statsd
    ports:
      - "8080:80"
      - "2003:2003"
      - "8125:8125"
      - "8126:8126"

  cadence:
    image: ubercadence/server:master-auto-setup
    ports:
      - "7933:7933"
      - "7934:7934"
      - "7935:7935"
      - "7939:7939"
    environment:
      - "DB=scylla"
      - "CASSANDRA_SEEDS=scylla"
      - "STATSD_ENDPOINT=statsd:8125"
      - "DYNAMIC_CONFIG_FILE_PATH=config/dynamicconfig/development.yaml"
    depends_on:
      - scylla
      - statsd

  cadence-web:
    image: ubercadence/web:latest
    environment:
      - "CADENCE_TCHANNEL_PEERS=cadence:7933"
    ports:
      - "8088:8088"
    depends_on:
      - cadence

  postgres:
    image: postgres
    environment:
      POSTGRES_DB: postgres
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      PGDATA: /data/postgres
    volumes:
      - postgres:/data/postgres

  nats:
    image: nats
    command: --config /etc/nats/nats-server.conf
    volumes:
      - ./nats/nats-server.conf:/etc/nats/nats-server.conf
    ports:
      - "8222:8222"
